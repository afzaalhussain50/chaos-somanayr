<html>
	<head>
		<title>	Circos Plots</title>
		<script type="text/javascript" src="Components.js"></script>
		<script type="text/javascript" src="CircosObjects.js"></script>
	</head>
	<body>
		<canvas id="circosPlot1" width=500 height=500>
		</canvas>
		<canvas id="circosPlot2" width=500 height=500>
		</canvas>
		<canvas id="circosPlot3" width=500 height=500>
		</canvas>
		<script type="text/javascript">
			var snd = new Audio("dingding.wav");
			snd.play();
		</script>
		<script type="text/javascript">
			var counter = 0;
			function generateChildren(c, canHaveChildren){
				var thickness = 5;
				var children = new Array();
				for (var i=c.start; i < c.end - .1;) {
					var sweep = Math.random() * (c.end / 2 - .1) + .1;
					if(i + sweep > c.end){
						if(c.end == Math.PI * 2){
							sweep = c.end - i - .1;
						} else {
							sweep = c.end - i;
						}
					}
					var subChild = new Arc(i, i + sweep, c.dist - 10, c.dist - 5, "".concat(counter++));
					i += sweep + .1;
					if(Math.random() > .75 && canHaveChildren){
						subChild.children = generateChildren(subChild, true);
					}
					children.push(subChild);
				}
				return children;
			}
		
			var canvas = document.getElementById("circosPlot1");
			var canvasContext = canvas.getContext("2d");
			var superArc = new Arc(0, 2 * Math.PI, 120, 140, "");
			superArc.children = generateChildren(superArc, true);
			var cons = new Array();
			var rand = Math.random() * 50;
			for(var i = 0; i < rand; i++) {
				var t1 = Math.random() * Math.PI * 2;
				var t2 = Math.random() * Math.PI * 2;
				while(t1 == t2) {
					t1 = Math.random() * Math.PI * 2;
				}
				cons.push(new Curve(Math.min(t1,t2), Math.max(t1,t2), 100));
			}
			var p = new CircosPlot(superArc, cons, {
				x:250,
				y:250
			}, new RenderingRules({
				font:"Verdana",
				fontPt:12,
				curveStroke:"#000000",
				arcFill:"#00FF00",
				rotation:0.0,
				scale:.5
			}));
			//p.render(canvasContext);
			
			var cp = new CircosPlot(superArc, cons, {x:250,y:250},new RenderingRules({
				font:"Verdana",
				fontPt:12,
				curveStroke:"#000000",
				arcFill:"#00FF00",
				rotation:0,
				scale:1
			}));
			
			
			var sccp = new SelfContainedCircosPlot(superArc, cons, 500, 500);
			
			sccp.render(canvasContext);
			
			var rot = 0;
			
			/*
			 * Listeners
			 */
			canvas.onmousedown = function(evt){
				var hit = sccp.getPlot().findHitByEvent(evt, canvasContext);
				if(hit == null){
					return;
				}
				p.createSubPlot(document.getElementById("circosPlot2").getContext("2d"), hit.start, hit.end, 500, 500);
				cp.zoomInOnSection(document.getElementById("circosPlot3").getContext("2d"), hit.start, hit.end, 500, 500);
			}
			
			canvas.onmouseup = function(evt){
				canvasContext.fillStyle = "#FFFFFF";
				canvasContext.fillRect(0,0,500,500);
				sccp.rotate(.1);
				sccp.render(canvasContext);
			}
			
			function drawSubPlot(start, end){
				var ctx2 = document.getElementById("circosPlot2").getContext("2d");
				var canvasW = 500;
				var canvasH = 500;
				ctx2.save();
				ctx2.fillStyle = "#FFFFFF";
				ctx2.fillRect(0, 0, canvasW, canvasH);
				p.createSubPlot(ctx2, [start],[end], 500, 500);
				ctx2.restore();
			}
		</script>
	</body>
</html>
<html>
	<head>
		<title>	Circos Plots</title>
		<script type="text/javascript" src="circos.js"></script>
		<script type="text/javascript" src="DataSet.js"></script>
	</head>
	<body>
		<canvas id="circosPlot" width=500 height=500 />
			<script type="text/javascript">
				"use strict";
				
				/* set up plot */
				var canvas = document.getElementById("circosPlot");
				var canvasContext = canvas.getContext("2d");
				var ds = {
					innerArcThickness: 5.0,
					innerTextOffset: 5,
					groupNames: ["Group A", "Group B", "Group C"],
					groupEnd: [1, 3, 5],
					colorScheme: ["blue", "rgba(100%, 25%, 100%, .5)", "rgba(100%, 0, 0, .5)", "rgba(100%, 100%, 0%, .5)", "rgba(100%, 0%, 100%, .5)"],
					splineOutline: "black",
					sweeps: [0.78539816339744830961566084581988, 1.0471975511965977461542144610932, .75, .75, .75, .75],
					labels: ["test0", "test1", "test2", "test3", "empty1", "empty2"],
					dist: 100,
					data1: [2, 1, 2, 3, 1],
					data2: [1, 0, 0, 1, 4],
					type : [1, 2, 3, 4, 0]
				};
				var circos = new Circos(ds);
				circos.render(canvasContext, {
					x: canvas.clientWidth / 2,
					y: canvas.clientHeight / 2
				}, canvas.clientWidth, canvas.clientHeight);
				function setUpFF(){
					
					/* set up mouse events for FF. Please switch away from IE */
					var mouseIsDown = false;
					var lastPosition = null;
					function mouseMoved(evt){
						var position = {x:evt.clientX - canvas.offsetLeft, y:evt.clientY - canvas.offsetTop};
						if(mouseIsDown){
							if(lastPosition == null){ //this should never happen
								lastPosition = position;
							}
							var x = lastPosition.x - position.x;
							var y = lastPosition.y - position.y;
							lastPosition = position;
							circos.handleMouseDrag(canvasContext, position, x, y);
						} else {
							circos.handleMouseOver(canvasContext, position);
						}
					}
					
					function mouseUp(evt){
						mouseIsDown = false;
					}
					
					function mouseDown(evt){
						lastPosition = {x:evt.clientX - canvas.offsetLeft, y:evt.clientY - canvas.offsetTop};
						mouseIsDown = true;
						circos.handleMouseDown(canvasContext, lastPosition);
					}
					
					function mouseScroll(evt){
						wheelDelta = evt.detail ? evt.detail : evt.wheelData;
						circos.handleMouseWheel(canvasContext, wheelDelta);
					}
					
					/* assign events */
					
					canvas.onmousedown = mouseDown;
					canvas.onmouseup = mouseUp;
					canvas.onmousemove = mouseMoved;
					
	
					/* From http://www.javascriptkit.com/javatutors/onmousewheel.shtml */
	
					var mousewheelevt=(/Firefox/i.test(navigator.userAgent))? "DOMMouseScroll" : "mousewheel" //FF doesn't recognize mousewheel as of FF3.x
	 
					if (canvas.attachEvent) //if IE (and Opera depending on user setting)
					    canvas.attachEvent("on"+mousewheelevt, mouseScroll)
					else if (canvas.addEventListener) //WC3 browsers
					    canvas.addEventListener(mousewheelevt, mouseScroll, false)
					    
					return true;
				}
				
				//TODO: later
				function setUpMobileSafari(){
					var center = {x:250, y:250};
					var oldTouches;
					
					function touchStart(evt){
						oldTouches = evt.touches;
					}
					
					function touchMove(evt){
						if(evt.touches.length == 1){
							var x = oldTouches[0].pageX - evt.touches[0].pageX;
							var y = oldTouches[0].pageY - evt.touches[0].pageY;
							center.x -= x;
							center.y -= y;
						} else if (evt.touches.length == 2){
							var detailShift = 0;
							var x0 = oldTouches[0].pageX - evt.touches[0].pageX;
							var y0 = oldTouches[0].pageY - evt.touches[0].pageY;
							var x1 = oldTouches[1].pageX - evt.touches[1].pageX;
							var y1 = oldTouches[1].pageY - evt.touches[1].pageY;
							if(evt.touches[0].pageX > evt.touches[1].pageX){
								if(x0 > 0){ /* away */
									/* zoom in */
									ds.dist += Math.abs(x0) + Math.abs(x1);
								} else if (x0 < 0){ /* togeather */
									ds.dist -= Math.abs(x0) + Math.abs(x1);
								}
							} else {
								if(x1 > 0){ /* away */
									/* zoom in */
									ds.dist += Math.abs(x0) + Math.abs(x1);
								} else if (x1 < 0){ /* togeather */
									ds.dist -= Math.abs(x0) + Math.abs(x1);
								}
							}
							if(evt.touches[0].pageY > evt.touches[1].pageY){
								if(y0 > 0){ /* away */
									/* zoom in */
									ds.dist += Math.abs(y0) + Math.abs(y1);
								} else if (y0 < 0){ /* togeather */
									ds.dist -= Math.abs(y0) + Math.abs(y1);
								}
							} else {
								if(y1 > 0){ /* away */
									/* zoom in */
									ds.dist += Math.abs(y0) + Math.abs(y1);
								} else if (y1 < 0){ /* togeather */
									ds.dist -= Math.abs(y0) + Math.abs(y1);
								}
							}
							
							/* render */
							circos.render(canvasContext, center, ds.dist);
						}
					}
					
					function touchEnd(evt){
						touches = null;
					}
					
					function touchCancel(evt){
						touches = null;
					}
					
					element.addEventListener("touchstart", touchStart, false);
					element.addEventListener("touchmove", touchMove, false);
					element.addEventListener("touchend", touchEnd, false);
					element.addEventListener("touchcancel", touchCancel, false)
				}
				if((navigator.userAgent.match(/iPhone/i)) || (navigator.userAgent.match(/iPod/i))) {
					setUpMobileSafari();
				} else {
					setUpFF();
				}
			</script>
	</body>
</html>